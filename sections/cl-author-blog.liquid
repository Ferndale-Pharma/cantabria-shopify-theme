{% comment %}
  CL Author Blog Grid – simplified & comparison‑safe
  --------------------------------------------------
  Renders an article card when either:
    • article.metafields.blog_post.author.value.id == metaobject.id
    • OR lower‑cased author names match.
  Uses a simple counter (printed) to decide whether to show the fallback.
{% endcomment %}

{{ 'component-article-card.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'section-main-blog.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }
  @media (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

{% comment %}
  Author Blog Articles Section
  This section displays all blog articles written by the current Author metaobject
{% endcomment %}

<div class="author-articles-section">
  <h2>Articles by {{ metaobject.name }}</h2>
  
  {% comment %}
    Get all blog articles from multiple blogs and filter by the current author
    We're checking: blog, skincare-guides, expert-advice, professionals
    Using for loops since where filter doesn't work reliably with deep metafields
  {% endcomment %}
  
  {% assign author_articles = '' | split: ',' %}
  {% assign blog_handles = 'blog,skincare-guides,expert-advice,professionals' | split: ',' %}
  
  {% comment %} Loop through each blog and collect matching articles {% endcomment %}
  {% for blog_handle in blog_handles %}
    {% for article in blogs[blog_handle].articles %}
      {% if article.metafields.blog_post.author.value.name == metaobject.name %}
        {% assign author_articles = author_articles | push: article %}
      {% endif %}
    {% endfor %}
  {% endfor %}
  
  {% if author_articles.size > 0 %}
    <div class="articles-grid">
      {% for article in author_articles %}
        <article class="article-card">
          {% if article.image %}
            <div class="article-image">
              <img src="{{ article.image | img_url: '400x300' }}" alt="{{ article.title }}" loading="lazy">
            </div>
          {% endif %}
          
          <div class="article-content">
            <h3 class="article-title">
              <a href="{{ article.url }}">{{ article.title }}</a>
            </h3>
            
            <div class="article-meta">
              <time datetime="{{ article.published_at | date: '%Y-%m-%d' }}">
                {{ article.published_at | date: '%B %d, %Y' }}
              </time>
              
              {% comment %} Display which blog this article is from {% endcomment %}
              <span class="article-blog">
                {% if article.blog.handle == 'blog' %}
                  Blog
                {% elsif article.blog.handle == 'skincare-guides' %}
                  Skincare Guides
                {% elsif article.blog.handle == 'expert-advice' %}
                  Expert Advice
                {% elsif article.blog.handle == 'professionals' %}
                  Professionals
                {% endif %}
              </span>
              
              {% if article.tags.size > 0 %}
                <div class="article-tags">
                  {% for tag in article.tags limit: 3 %}
                    <span class="tag">{{ tag }}</span>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
            
            {% if article.excerpt %}
              <p class="article-excerpt">{{ article.excerpt | truncate: 150 }}</p>
            {% endif %}
            
            <a href="{{ article.url }}" class="read-more">Read More</a>
          </div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <p class="no-articles">No articles found for this author.</p>
  {% endif %}
</div>

{% comment %}
  Alternative approach using a for loop with conditional filtering:
  This is useful if you need more complex filtering logic or want to sort by date
{% endcomment %}

{% comment %}
<div class="author-articles-section-alt">
  <h2>Articles by {{ metaobject.name }}</h2>
  
  {% assign all_author_articles = '' | split: ',' %}
  {% assign found_articles = false %}
  
  {% comment %} Loop through all blogs and collect matching articles {% endcomment %}
  {% for article in blogs.blog.articles %}
    {% if article.metafields.blog_post.author.value.name == metaobject.name %}
      {% assign all_author_articles = all_author_articles | push: article %}
      {% assign found_articles = true %}
    {% endif %}
  {% endfor %}
  
  {% for article in blogs.skincare-guides.articles %}
    {% if article.metafields.blog_post.author.value.name == metaobject.name %}
      {% assign all_author_articles = all_author_articles | push: article %}
      {% assign found_articles = true %}
    {% endif %}
  {% endfor %}
  
  {% for article in blogs.expert-advice.articles %}
    {% if article.metafields.blog_post.author.value.name == metaobject.name %}
      {% assign all_author_articles = all_author_articles | push: article %}
      {% assign found_articles = true %}
    {% endif %}
  {% endfor %}
  
  {% for article in blogs.professionals.articles %}
    {% if article.metafields.blog_post.author.value.name == metaobject.name %}
      {% assign all_author_articles = all_author_articles | push: article %}
      {% assign found_articles = true %}
    {% endif %}
  {% endfor %}
  
  {% comment %} Sort by published date (newest first) {% endcomment %}
  {% assign sorted_articles = all_author_articles | sort: 'published_at' | reverse %}
  
  <div class="articles-grid">
    {% for article in sorted_articles %}
      <article class="article-card">
        <h3><a href="{{ article.url }}">{{ article.title }}</a></h3>
        <time>{{ article.published_at | date: '%B %d, %Y' }}</time>
        <span class="blog-name">{{ article.blog.title }}</span>
      </article>
    {% endfor %}
  </div>
  
  {% unless found_articles %}
    <p class="no-articles">No articles found for this author.</p>
  {% endunless %}
</div>
{% endcomment %}


{% schema %}
{
  "name": "CL Author Blog Grid",
  "tag": "section",
  "class": "section",
  "settings": [
    {"type":"select","id":"layout","options":[{"value":"grid","label":"Grid"},{"value":"collage","label":"Collage"}],"default":"grid","label":"Layout"},
    {"type":"checkbox","id":"show_image","label":"Show images","default":true},
    {"type":"select","id":"image_height","options":[{"value":"adapt","label":"Adapt"},{"value":"small","label":"Small"},{"value":"medium","label":"Medium"},{"value":"large","label":"Large"}],"default":"medium","label":"Image height"},
    {"type":"checkbox","id":"show_date","label":"Show date","default":true},
    {"type":"checkbox","id":"show_author","label":"Show author","default":false},
    {"type":"range","id":"padding_top","label":"Padding top","min":0,"max":100,"step":4,"unit":"px","default":64},
    {"type":"range","id":"padding_bottom","label":"Padding bottom","min":0,"max":100,"step":4,"unit":"px","default":64}
  ],
  "presets": [ { "name": "CL Author Blog Grid" } ]
}
{% endschema %}
