{% comment %}
  CL Author Blog Grid – simplified & comparison‑safe
  --------------------------------------------------
  Renders an article card when either:
    • article.metafields.blog_post.author.value.id == metaobject.id
    • OR lower‑cased author names match.
  Uses a simple counter (printed) to decide whether to show the fallback.
{% endcomment %}

{{ 'component-article-card.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'section-main-blog.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }
  @media (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}
{% comment %}
  Author Blog Articles Section
  This section displays all blog articles written by the current Author metaobject
{% endcomment %}

<div style="background: #f0f0f0; padding: 10px; margin: 10px 0;">
  <p><strong>Debug Info:</strong></p>
  <p>Current metaobject name: "{{ metaobject.name }}"</p>
  <p>Sample article author: "{{ blogs.blog.articles.first.metafields.blog_post.author.value.name }}"</p>
  {% if blogs.blog.articles.first.metafields.blog_post.author.value.name == metaobject.name %}
    <p>They are equal</p>
  {% else %}
    <p>They are not equal</p>
  {% endif %}
  
  <p><strong>Authors found in first 10 blog articles:</strong></p>
  {% for article in blogs.blog.articles limit: 10 %}
    {% assign author_name = article.metafields.blog_post.author.value.name %}
    <p>"{{ author_name }}" {% if author_name == metaobject.name %}← MATCH!{% endif %}</p>
  {% endfor %}
</div>

<div class="author-articles-section">
  <h2>Articles by {{ metaobject.name }}</h2>
  
  {% comment %}
    Collect articles from all blogs by the current author
    We're checking: blog, skincare-guides, expert-advice, professionals
  {% endcomment %}
  
  {% assign all_articles = '' | split: '' %}
  {% assign found_articles = false %}
  
  {% comment %} Collect articles from blog {% endcomment %}
  {% for article in blogs.blog.articles %}
    {% if article.metafields.blog_post.author.value.name == metaobject.name %}
      {% assign found_articles = true %}
      {% assign all_articles = all_articles | concat: article %}
    {% endif %}
  {% endfor %}
  
  {% comment %} Collect articles from skincare-guides {% endcomment %}
  {% for article in blogs.skincare-guides.articles %}
    {% if article.metafields.blog_post.author.value.name == metaobject.name %}
      {% assign found_articles = true %}
      {% assign all_articles = all_articles | concat: article %}
    {% endif %}
  {% endfor %}
  
  {% comment %} Collect articles from expert-advice {% endcomment %}
  {% for article in blogs.expert-advice.articles %}
    {% if article.metafields.blog_post.author.value.name == metaobject.name %}
      {% assign found_articles = true %}
      {% assign all_articles = all_articles | concat: article %}
    {% endif %}
  {% endfor %}
  
  {% comment %} Collect articles from professionals {% endcomment %}
  {% for article in blogs.professionals.articles %}
    {% if article.metafields.blog_post.author.value.name == metaobject.name %}
      {% assign found_articles = true %}
      {% assign all_articles = all_articles | concat: article %}
    {% endif %}
  {% endfor %}
  
  {% comment %} Sort articles by published_at date (newest first) {% endcomment %}
  {% assign sorted_articles = all_articles | sort: 'published_at' | reverse %}
  
  <div class="articles-grid">
    {% comment %} Display all articles sorted by date {% endcomment %}
    {% for article in sorted_articles %}
      {% comment %} Determine which blog this article belongs to by checking article IDs {% endcomment %}
      {% assign blog_name = 'Blog' %}
      {% for blog_article in blogs.blog.articles %}
        {% if blog_article.id == article.id %}
          {% assign blog_name = 'Blog' %}
          {% break %}
        {% endif %}
      {% endfor %}
      {% for skincare_article in blogs.skincare-guides.articles %}
        {% if skincare_article.id == article.id %}
          {% assign blog_name = 'Skincare Guides' %}
          {% break %}
        {% endif %}
      {% endfor %}
      {% for expert_article in blogs.expert-advice.articles %}
        {% if expert_article.id == article.id %}
          {% assign blog_name = 'Expert Advice' %}
          {% break %}
        {% endif %}
      {% endfor %}
      {% for professional_article in blogs.professionals.articles %}
        {% if professional_article.id == article.id %}
          {% assign blog_name = 'Professionals' %}
          {% break %}
        {% endif %}
      {% endfor %}
      
      <article class="article-card">
        {% if article.image %}
          <div class="article-image">
            <img src="{{ article.image | img_url: '400x300' }}" alt="{{ article.title }}" loading="lazy" width="400" height="300">
          </div>
        {% endif %}
        
        <div class="article-content">
          <h3 class="article-title">
            <a href="{{ article.url }}">{{ article.title }}</a>
          </h3>
          
          <div class="article-meta">
            <time datetime="{{ article.published_at | date: '%Y-%m-%d' }}">
              {{ article.published_at | date: '%B %d, %Y' }}
            </time>
            
            <span class="article-blog">{{ blog_name }}</span>
            
            {% if article.tags.size > 0 %}
              <div class="article-tags">
                {% for tag in article.tags limit: 3 %}
                  <span class="tag">{{ tag }}</span>
                {% endfor %}
              </div>
            {% endif %}
          </div>
          
          {% if article.excerpt %}
            <p class="article-excerpt">{{ article.excerpt | truncate: 150 }}</p>
          {% endif %}
          
          <a href="{{ article.url }}" class="read-more">Read More</a>
        </div>
      </article>
    {% endfor %}
  </div>
  
  {% unless found_articles %}
    <p class="no-articles">No articles found for this author.</p>
  {% endunless %}
</div>

{% schema %}
{
  "name": "CL Author Blog Grid",
  "tag": "section",
  "class": "section",
  "settings": [
    {"type":"select","id":"layout","options":[{"value":"grid","label":"Grid"},{"value":"collage","label":"Collage"}],"default":"grid","label":"Layout"},
    {"type":"checkbox","id":"show_image","label":"Show images","default":true},
    {"type":"select","id":"image_height","options":[{"value":"adapt","label":"Adapt"},{"value":"small","label":"Small"},{"value":"medium","label":"Medium"},{"value":"large","label":"Large"}],"default":"medium","label":"Image height"},
    {"type":"checkbox","id":"show_date","label":"Show date","default":true},
    {"type":"checkbox","id":"show_author","label":"Show author","default":false},
    {"type":"range","id":"padding_top","label":"Padding top","min":0,"max":100,"step":4,"unit":"px","default":64},
    {"type":"range","id":"padding_bottom","label":"Padding bottom","min":0,"max":100,"step":4,"unit":"px","default":64}
  ],
  "presets": [ { "name": "CL Author Blog Grid" } ]
}
{% endschema %} 