{% comment %}
  CL Author Blog Grid – simplified & comparison‑safe
  --------------------------------------------------
  Renders an article card when either:
    • article.metafields.blog_post.author.value.id == metaobject.id
    • OR lower‑cased author names match.
  Uses a simple counter (printed) to decide whether to show the fallback.
{% endcomment %}

{{ 'component-article-card.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'section-main-blog.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }
  @media (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

{%- assign cur_auth          = metaobject -%}
{%- assign cur_auth_id       = cur_auth.id -%}
{%- assign cur_auth_name_raw = cur_auth.name | default: cur_auth.title | default: cur_auth.handle -%}
{%- assign cur_auth_name     = cur_auth_name_raw | strip | downcase -%}

{%- assign printed = 0 -%}

<div class="main-blog page-width section-{{ section.id }}-padding">
  <h1 class="title--primary">{{ cur_auth_name_raw | escape }}</h1>
  <div class="blog-articles{% if section.settings.layout == 'collage' %} blog-articles--collage{% endif %}">

  {%- comment -%} Iterate through every blog in the shop {%- endcomment -%}
  {%- for blog_key in blogs -%}
    {%- assign blog = blogs[blog_key] -%}
    {%- for article in blog.articles -%}
      {%- assign art_author = article.metafields.blog_post.author.value -%}
      {%- if art_author -%}
        {%- assign art_name = art_author.name | default: art_author.title | default: art_author.handle | strip | downcase -%}
        {%- if art_author.id == cur_auth_id or art_name == cur_auth_name -%}
          {%- assign printed = printed | plus: 1 -%}
          <div class="blog-articles__article article">
            {%- render 'cl-article-card',
              article:            article,
              media_height:       section.settings.image_height,
              media_aspect_ratio: article.image.aspect_ratio,
              show_image:         section.settings.show_image,
              show_date:          section.settings.show_date,
              show_author:        section.settings.show_author,
              show_excerpt:       true -%}
          </div>
        {%- endif -%}
      {%- endif -%}
    {%- endfor -%}
  {%- endfor -%}

  </div>

  {%- if printed == 0 -%}
    <p>{{ cur_auth_name_raw | escape }} has not published any articles yet.</p>
  {%- endif -%}
</div>

{% schema %}
{
  "name": "CL Author Blog Grid",
  "tag": "section",
  "class": "section",
  "settings": [
    {"type":"select","id":"layout","options":[{"value":"grid","label":"Grid"},{"value":"collage","label":"Collage"}],"default":"grid","label":"Layout"},
    {"type":"checkbox","id":"show_image","label":"Show images","default":true},
    {"type":"select","id":"image_height","options":[{"value":"adapt","label":"Adapt"},{"value":"small","label":"Small"},{"value":"medium","label":"Medium"},{"value":"large","label":"Large"}],"default":"medium","label":"Image height"},
    {"type":"checkbox","id":"show_date","label":"Show date","default":true},
    {"type":"checkbox","id":"show_author","label":"Show author","default":false},
    {"type":"range","id":"padding_top","label":"Padding top","min":0,"max":100,"step":4,"unit":"px","default":64},
    {"type":"range","id":"padding_bottom","label":"Padding bottom","min":0,"max":100,"step":4,"unit":"px","default":64}
  ],
  "presets": [ { "name": "CL Author Blog Grid" } ]
}
{% endschema %}
